#!/usr/bin/env sh

set -e

for var in $(echo "$PHP_INI_OVERRIDES" | tr \; \\n); do
  echo "$var" >> /usr/local/etc/php/php.ini
done

# Fix permissions on private storage
if [ -d "/data/private" ]; then
  chown -R www-data:www-data /data/private
fi

# Fix permissions on public storage for multisite installations
if [ -d "/usr/share/nginx/html/web/sites" ]; then
  find /usr/share/nginx/html/web/sites/ -name files -exec chown -R www-data:www-data {} \+
fi

supervisord --nodaemon --configuration /etc/supervisord.conf